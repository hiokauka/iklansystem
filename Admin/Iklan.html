    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AdSpace</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

        <style>
           body {
    font-family: "Montserrat", sans-serif;
    font-size: 18px;
    background: #ffffff;
    color: #222;
    margin: 0;
    padding: 0;
}

header {
    background: #1a093c;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    padding: 10px 15px;
}

.title {
    font-weight: 700;
    font-size: 2.2rem;
    color: #ffffff;
    margin: 15px auto;
    text-align: center;
}

.sidebar {
    width: 260px;
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    background: white;
    padding: 1.5rem;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    display: none;
    z-index: 1050;
    overflow-y: auto;
}

nav a {
    font-size: 20px;
    padding: 10px 0;
    display: block;
}

.card {
    border-radius: 12px;
}

.card-body h5 {
    font-size: 1.4rem;
}

.btn {
    font-size: 18px;
    padding: 10px 16px;
    cursor: pointer;
}

.footer-text {
    font-size: 17px;
}

.button-group {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: auto;
    color: #001f4e;
    flex-wrap: wrap;
}

.btn-details {
    background-color: #001638;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

button:focus,
a:focus {
    outline: 3px solid #0d6efd55;
}

.ad-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.ad-card {
    transition: all 0.3s ease;
    border: #001638 solid 1px;
}

.main-content-home {
    flex: 1;
}

/* Buttons */
button {
    padding: 5px 10px;
    background-color: #0d6efd;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background-color: #0b5ed7;
}

.btn-navbar {
    font-size: 24px;
    background: none;
    border: white solid 2px;
    border-radius: 8px;
    cursor: pointer;
    color: white;
}

.card-img-top {
    width: 100%;       /* full width of the card */
    height: 200px;     /* fixed height */
    object-fit: cover; /* maintain aspect ratio, crop if needed */
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}

/* Responsive adjustments */
@media (max-width: 1024px) {
    .title {
        font-size: 2rem;
        margin-left: auto;
        margin-right: auto;
    }
    .btn {
        font-size: 16px;
        padding: 8px 12px;
    }
    .card-body h5 {
        font-size: 1.2rem;
    }
}

@media (max-width: 768px) {
    .title {
        font-size: 1.8rem;
    }
    .nav a {
        font-size: 18px;
    }
    .button-group {
        flex-direction: column;
        gap: 0.5rem;
    }
    .btn-details {
        width: 90%;
        text-align: center;
        margin: 0 auto;
    }
}

@media (max-width: 480px) {
    .title {
        font-size: 1.5rem;
    }
    .btn-navbar {
        font-size: 20px;
    }
    .btn {
        font-size: 14px;
        padding: 6px 10px;
    }
    .card-body h5 {
        font-size: 1rem;
    }
}

        </style>
    </head>

    <body class=" min-vh-100 d-flex flex-column">
        <!-- Header -->
        <header class="mb-4 p-3 shadow-sm  d-flex flex-column flex-md-row">

            <button class="btn-navbar mt-3" id="toggleSidebar">☰</button>
            <h1 class="  title "> HUB PENGIKLANAN DIGITAL</h1>

        </header>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="btn-close mb-3" id="closeSidebar"></button>
            <nav class="d-flex flex-column my-4">
                <a href="/Admin/Ahome.html" class="mb-2 text-decoration-none text-dark">Laman Utama</a>

                <a href="/Admin/Payment.html" class="mb-2 text-decoration-none text-dark">Pembayaran Bonus</a>

                <a href="/Admin/Iklan.html" class="mb-2 text-decoration-none text-dark">Tambah Iklan</a>

                <a href="/Admin/Pin.html" class="mb-2 text-decoration-none text-dark">Jana Pin</a>

                <a href="#" id="logoutLink" class="mb-2 text-decoration-none" style="color: red;">Log Keluar</a>
            </nav>
        </div>


        <div class=" main-content-home d-flex flex-column">
            <!-- Main Content -->

            <div class="d-flex justify-content-center mb-3">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAdModal">
                    + Tambah Iklan
                </button>
            </div>
            <div class="container  my-4">
                <div class="row g-4" id="adsContainer">
                    <!-- Ads will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Add New Ad Modal -->
        <div class="modal fade" id="addAdModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title">Tambah Iklan Baru</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <form id="addAdForm">

                            <label class="form-label mt-2">Tajuk</label>
                            <input type="text" class="form-control" id="newTitle">

                            <label class="form-label mt-2">Harga</label>
                            <input type="number" class="form-control" id="newPrice">

                            <label class="form-label mt-2">Deskripsi</label>
                            <textarea class="form-control" rows="3" id="newDescription"></textarea>

                            <div class="form-group">
                                <label for="postImage">Tambah Gambar (Optional)</label>
                                <input type="file" class="form-control-file" id="postImage" accept="image/*">
                            </div>

                            <button id="saveAdBtn" class="btn btn-success w-100 mt-3">Simpan Iklan</button>

                        </form>
                    </div>

                </div>
            </div>
        </div>


        <!-- Ad Modal (View & Edit) -->
        <div class="modal fade" id="adModal1" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="adTitle">Ad Title 1</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body text-center">

                        <img id="adImage" src="https://via.placeholder.com/400x250" class="img-fluid rounded mb-3" />

                        <p class="text-primary fw-bold" id="adPrice">$50</p>
                        <p id="adDescription">Description for Ad 1 goes here.</p>

                        <!-- Hidden form for editing -->
                        <form id="editForm" class="text-start" style="display:none;">
                            <label class="form-label mt-2">Tajuk</label>
                            <input id="editTitle" type="text" class="form-control">

                            <label class="form-label mt-2">Harga</label>
                            <input id="editPrice" type="text" class="form-control">

                            <label class="form-label mt-2">Deskripsi</label>
                            <textarea id="editDescription" class="form-control" rows="3"></textarea>

                          
                        </form>

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>

                        <button type="button" class="btn btn-warning" id="editBtn" onclick="enableEdit()">Edit</button>
                        <button type="button" class="btn btn-success" id="saveBtn" style="display:none;">Save</button>
                        <button type="button" class="btn btn-danger" id="deleteBtn">Delete</button>

                    </div>

                </div>
            </div>
        </div>




        <!-- Footer -->
        <footer class="mt-5 text-center text-muted py-2">
            © 2025 AdSpace. All rights reserved.
        </footer>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>




        <!-- Sidebar Toggle Script -->
        <script>
            const username = localStorage.getItem("username");
            if (!username) {
                window.location.href = "/index.html";
            }

            const toggleBtn = document.getElementById('toggleSidebar');
            const closeBtn = document.getElementById('closeSidebar');
            const sidebar = document.getElementById('sidebar');

            toggleBtn.addEventListener('click', () => {
                sidebar.style.display = 'block';
            });
            closeBtn.addEventListener('click', () => {
                sidebar.style.display = 'none';
            });
        </script>



        <script>
            const logoutLink = document.getElementById('logoutLink');

            logoutLink.addEventListener('click', (e) => {
                e.preventDefault();

                // Show confirmation dialog
                const confirmed = confirm("Adakah anda pasti mahu log keluar?");
                if (!confirmed) return; // Stop if user cancels

                // Clear localStorage login flags
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('username');

                // Redirect to login page
                window.location.href = '/index.html';
            });
        </script>

        <script type="module">
            import { supabase } from '/supabase.js';

            // Attach to the form submit event
            document.getElementById("addAdForm").addEventListener("submit", addNewAd);

            async function addNewAd(e) {
                e.preventDefault(); // Prevent form submission and page refresh

                const title = document.getElementById("newTitle").value;
                const price = parseFloat(document.getElementById("newPrice").value);
                const description = document.getElementById("newDescription").value;
                const imageFile = document.getElementById("postImage").files[0];

                if (!title) return alert("Sila masukkan tajuk iklan!");

                let imageUrl = null;

                // ✅ Upload image to Cloudinary if exists
                if (imageFile) {
                    const formData = new FormData();
                    formData.append("file", imageFile);
                    formData.append("upload_preset", "ads-example"); // replace with your preset

                    try {
                        const res = await fetch(`https://api.cloudinary.com/v1_1/dhvhgjtgr/image/upload`, {
                            method: "POST",
                            body: formData
                        });
                        const data = await res.json();
                        imageUrl = data.secure_url; // the URL to save in Supabase
                    } catch (err) {
                        console.error("Failed to upload image:", err);
                        alert("Gagal memuat naik imej.");
                        return;
                    }
                }

                // ✅ Insert into Supabase ads table
                const userId = localStorage.getItem("user_id"); // admin user
                const { data, error } = await supabase.from("adverts").insert([
                    {
                        title,
                        description,
                        price,
                        image_url: imageUrl,
                        created_by: userId ? parseInt(userId) : null
                    }
                ]);

                if (error) {
                    console.error(error);
                    alert("Gagal menambah iklan baru.");
                    return;
                }


                alert("Iklan berjaya ditambah!");
                document.getElementById("addAdForm").reset();

                // Optionally close modal (if using Bootstrap modal)
                const modalEl = document.getElementById("addAdModal");
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
                location.reload();
            }
        </script>

        <script type="module">
            import { supabase } from '/supabase.js';

            async function loadAds() {
                const container = document.getElementById("adsContainer");

                // Fetch all ads
                const { data: ads, error } = await supabase
                    .from("adverts")
                    .select("*")
                    .order("created_at", { ascending: false });

                if (error) {
                    console.error("Error fetching ads:", error);
                    return;
                }

                container.innerHTML = ""; // Clear container

                ads.forEach(ad => {
                    const card = `
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <div class="card h-100 ad-card shadow-sm">
                    <img src="${ad.image_url || '/assets/images/image.png'}" class="card-img-top" alt="${ad.title}" />
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${ad.title}</h5>
                        <p class="text-primary fw-bold">${ad.description}</p>
                        <div class="button-group">
                            <button class="btn-details mt-auto" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#adModal1"
                                    data-id="${ad.id}"
                                    data-title="${ad.title}"
                                    data-description="${ad.description}"
                                    data-price="${ad.price}"
                                    data-image="${ad.image_url}">
                                Lihat Butiran
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            `;
                    container.innerHTML += card;
                });

                attachModalEvents();
            }

            

            // ✅ Populate modal dynamically
            let currentAdId = null; // store which ad is currently in modal

            function attachModalEvents() {
                document.querySelectorAll(".btn-details").forEach(btn => {
                    btn.addEventListener("click", e => {
                        const button = e.currentTarget;
                        currentAdId = parseInt(button.dataset.id); // store ad ID
                        console.log("Current Ad ID:", currentAdId);
                        const title = button.dataset.title;
                        const description = button.dataset.description;
                        const price = button.dataset.price;
                        const image = button.dataset.image;

                        document.getElementById("adTitle").innerText = title;
                        document.getElementById("adDescription").innerText = description;
                        document.getElementById("adPrice").innerText = "RM " + price;
                        document.getElementById("adImage").src = image || "/assets/images/image.png";

                        // Reset edit form
                        document.getElementById("editForm").style.display = "none";
                        document.getElementById("saveBtn").style.display = "none";
                        document.getElementById("editBtn").style.display = "inline-block";

                        document.getElementById("editTitle").value = title;
                        document.getElementById("editPrice").value = price;
                        document.getElementById("editDescription").value = description;
                       
                    });
                });
            }

            // Enable Edit Form
            window.enableEdit = function () {
                document.getElementById("editForm").style.display = "block";
                document.getElementById("saveBtn").style.display = "inline-block";
                document.getElementById("editBtn").style.display = "none";
            }

            // Save Changes to Supabase
            document.getElementById("saveBtn").addEventListener("click", async () => {
                if (!currentAdId) return;

                const title = document.getElementById("editTitle").value;
                const price = parseFloat(document.getElementById("editPrice").value);
                const description = document.getElementById("editDescription").value;
                

                const { data, error } = await supabase
                    .from("adverts")
                    .update({
                        title,
                        price,
                        description,
                        
                    })
                    .eq("id", currentAdId);

                if (error) {
                    console.error(error);
                    alert("Gagal mengemas kini iklan.");
                    return;
                }

                alert("Iklan berjaya dikemas kini!");
                loadAds(); // refresh ad cards
                document.querySelector("#adModal1 .btn-close").click(); // close modal
            });

            // Delete Ad from Supabase
            document.getElementById("deleteBtn").addEventListener("click", async () => {
                if (!currentAdId) return;
                if (!confirm("Adakah anda pasti ingin memadam iklan ini?")) return;

                const { data, error } = await supabase
                    .from("adverts")
                    .delete()
                    .eq("id", currentAdId);

                if (error) {
                    console.error(error);
                    alert("Gagal memadam iklan.");
                    return;
                }

                alert("Iklan berjaya dipadam!");
                loadAds(); // refresh ad cards
                document.querySelector("#adModal1 .btn-close").click(); // close modal
            });
            loadAds();

        </script>




    </body>

    </html>